<!doctype html><html lang=en><head><meta charset=utf-8><title>Week02</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1305>We&rsquo;ll get started at 13:05</h2></section><section data-noprocess data-shortcode-slide class=center><h2 id=client-side-exploitation>client-side exploitation</h2><h2 id=week02>week02</h2></section><section><h2 id=disclaimer>disclaimer</h2><ul><li>many of the tools and techniques discussed in these sessions could be used against real applications</li><li>don&rsquo;t do that</li></ul></section><section><h2 id=acknowledgement-of-country>acknowledgement of country</h2><ul><li>We begin by acknowledging the Traditional Custodians of the land on which we meet, and pay our respects to their Elders past and present. We extend that arespect to Aboriginal and Torres Strait Islander peoples here today.</li></ul></section><section><h2 id=client-side-injection>Client-side injection</h2><ul><li>HTML Injection</li><li>XSS</li><li>CSRF</li><li>Clickjacking</li></ul></section><section><section data-shortcode-section><h3 id=html-injection>HTML injection</h3><ul><li>Browsers just render the DOM</li><li>How would it know if tags are user-supplied or server-supplied</li><li>what if our input was just <code>&lt;s></code>?</li></ul></section><section><h3 id=why-is-this-dangerous>why is this dangerous?</h3><p>most tags aren&rsquo;t really concerning (<code>&lt;b></code>, <code>&lt;h1></code>), but some can be</p><ul><li><code>&lt;form></code></li><li><code>&lt;iframe></code></li><li><code>&lt;script></code></li><li><code>&lt;img></code></li></ul></section><section><h3 id=know-your-tags>Know your tags</h3><ul><li>Some are paired <code>&lt;div>&lt;/div></code></li><li>Some aren&rsquo;t <code>&lt;img src=.../></code></li></ul><blockquote><p>just google what they do/how to use them</p></blockquote></section></section><section><section data-shortcode-section><h3 id=xss-cross-site-scripting>XSS (cross-site scripting)</h3><ul><li>another &lsquo;mixing of data and control&rsquo; issue<ul><li>your browser only receives a single stream of data</li><li>the content of the stream determines if it&rsquo;s control or data</li></ul></li><li>Tricking a <strong>browser</strong> into executing your code</li></ul></section><section><h3 id=reflected-xss>Reflected XSS</h3><ul><li>Payload is part of user input<ul><li>e.g. a search query, cookie, header, etc</li><li>anything insecurely rendered on the page</li></ul></li></ul><blockquote><p><a href><code>www.example.com/database?q=&lt;script>alert(1)&lt;/script></code></a></p></blockquote></section><section><h3 id=stored-xss>Stored XSS</h3><ul><li>Payload is stored in some database<ul><li>Anybody who visits a certain page will view it</li><li>e.g. blog posts, twitter (lol)</li></ul></li><li>generally worse, but more easily detected</li></ul></section><section><h3 id=dom-based-xss>DOM-based XSS</h3><ul><li>Similar to the others, but the vulnerability comes from modifying the DOM</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pos</span><span style=color:#f92672>=</span>document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;context=&#34;</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>write</span>(document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>pos</span>,document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>length</span>));
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div></section><section><h3 id=demo>Demo!</h3></section><section><h3 id=xss-isnt-just-script-tags>XSS isn&rsquo;t just <code>&lt;script></code> tags</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// event-handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#a6e22e>x</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// injecting into javascript code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;user_input&gt;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and much more
</span></span></span></code></pre></div><blockquote><p>it&rsquo;s any time you get user supplied input in a javascript context</p></blockquote></section><section><h3 id=some-good-resources>Some good resources</h3><ul><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection>PayloadAllTheThings</a></li><li><a href=https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html>OWASP Cheat Sheet</a></li><li><a href=https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting>HackTricks</a></li><li><a href=https://portswigger.net/web-security/cross-site-scripting/cheat-sheet>PortSwigger</a></li></ul></section></section><section><section data-shortcode-section><h2 id=mitigating-xss>Mitigating XSS</h2></section><section><h3 id=basic-waf-stuff>Basic WAF stuff</h3><ul><li><em>Sanitisation</em>: stripping out unsafe tags/attributes<ul><li>&lt;script>alert(1)&lt;script> → alert(1)</li></ul></li><li><em>Encoding</em>: escaping control characters<ul><li>&lt;> → &amp;lt;&amp;gt;</li></ul></li><li><em>Validation</em>: allow/block-listing of content<ul><li>block requests if you detect bad content</li></ul></li></ul></section><section><h3 id=dont-use-raw-user-input>Don&rsquo;t use raw user input</h3><ul><li><p><code>.innerHTML</code> treats content as HTML (control)</p><ul><li>use <code>.innerText</code> which treats it as data</li></ul></li><li><p>sanitize your input with a library (DOMPurify???)</p></li><li><p>don&rsquo;t write vanilla JS, use a framework.</p><ul><li>again, even if you use a framework, make sure the functions you&rsquo;re using sanitize the input</li></ul></li></ul></section><section><h3 id=breaking-mitigations>Breaking mitigations</h3><ul><li>Content stripped/blocked<ul><li>embed dummy characters: <code>&lt;SCRscriptIPT></code></li><li>use alternating case: <code>&lt;ScRiPt></code></li><li>different tag <code>&lt;img onerror=...></code></li><li>different event handler <code>&lt;body onload=...></code></li></ul></li></ul><p><a href=https://github.com/payloadbox/xss-payload-list>here&rsquo;s a couple more</a></p></section><section><h2 id=csp>CSP</h2><ul><li><p>Limits where you can load content from, e.g.</p><ul><li>only scripts from local scripts</li><li>only images from <code>example.com/path</code></li></ul></li><li><p>only elements with a certain nonce value</p></li><li><p>generally blocks iframes, inline scripts, <code>eval()</code></p></li><li><p>basically it&rsquo;s kinda smurfing, it&rsquo;s hard to bypass</p></li></ul></section><section><h3 id=where-is-it-defined>Where is it defined</h3><ul><li><p>HTTP header</p><ul><li><code>Content-Security-Policy: ???-src &lt;directive></code></li></ul></li><li><p>Or in a tag</p><ul><li><code>&lt;meta http-equiv="Content-Security-Policy" content="???-src &lt;directive>"></code></li><li>though not as powerful</li></ul></li></ul></section><section><h3 id=how-to-break-it>How to break it?</h3><ul><li>Corrupting the HTTP header (response splitting?)</li><li>Overwriting the <code>&lt;meta></code> tag?</li></ul></section></section><section><section data-shortcode-section><h2 id=csrf>CSRF</h2><p>cross-site request forgery</p></section><section><h3 id=what-is-it>What is it?</h3><ul><li>trick a user into performing an unintended action<ul><li>make them authorize a bank transaction</li><li>make them change their email/password</li><li>(if they&rsquo;re admin) probably even worse stuff</li></ul></li></ul></section><section><h3 id=examples>examples</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://bank.com/send?to=hacker&amp;amount=10000&#34;</span>&gt;Click me!&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://bank.com/send?to=hacker&amp;amount=1000&#34;</span>&gt;
</span></span></code></pre></div></section><section><h3 id=demo>Demo!</h3></section><section></section></section><section><section data-shortcode-section><h2 id=mitigating-csrf>Mitigating CSRF</h2></section><section><h3 id=csrf-tokens>CSRF Tokens</h3><p>Supply a single-use &rsquo;nonce&rsquo; value.</p><ul><li>When the page is loaded, generate the nonce</li><li>When a request is made, it must include the nonce</li><li>It&rsquo;ll be stored as a: cookie, header, <code>&lt;input></code></li></ul></section><section><h3 id=csrf-mitigations>CSRF Mitigations</h3><ul><li>CSRF Tokens, a nonce value supplied as input</li><li>Randomly generated when the page is loaded<ul><li>stored as a cookie, header, <code>&lt;input></code></li></ul></li><li>When a request is made, backend verifies the nonce</li></ul></section><section><h2 id=quick-demo>Quick demo</h2></section><section><h3 id=breaking-mitigations>Breaking mitigations</h3><ul><li>Bad programming, they might be doing it wrong<ul><li>Re-use a previous token (if it doesn&rsquo;t expire)</li><li>Create your own?</li><li>They might not even check it.</li></ul></li></ul></section></section><section><section data-shortcode-section><h2 id=click-jacking>click-jacking</h2></section><section><h3 id=what-is-it>what is it?</h3><p>A fake form sitting on top of/below a real form</p><ul><li>if you try to interact with the fake form, you&rsquo;ll accidentally interact with the real one.</li></ul></section><section><h3 id=where-could-it-come-from>where could it come from?</h3><ul><li>This could be either local, or external<ul><li>local: same form switch confirm/cancel buttons</li><li>external: an invisible iframe with a higher z-index</li></ul></li></ul></section><section><h3 id=demo>Demo</h3></section></section><section><h3 id=practice>Practice</h3><ul><li><a href=https://portswigger.net/web-security/all-labs>portswigger labs</a></li><li><a href=https://ringzer0ctf.com/challenges>ringerzer0</a></li><li><a href=https://owasp.org/www-project-juice-shop/>juice shop</a></li></ul></section><section><h3 id=next-week>next week</h3><p>backend vulnerability</p><ul><li>sql injection</li><li>command injection</li><li>serverside template injection</li><li>file uploads</li><li>serverside request forgery (SSRF)</li></ul></section><section><h2 id=thanks>thanks!</h2><p>that&rsquo;s all :)</p></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>