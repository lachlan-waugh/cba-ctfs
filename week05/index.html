<!doctype html><html lang=en><head><meta charset=utf-8><title>05: forensics</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1305>We&rsquo;ll get started at 13:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=digital-forensics--incident-response>Digital Forensics & Incident Response</h1><h2 id=week05>Week05</h2></section><section><h2 id=disclaimer>disclaimer</h2><ul><li>many of the tools and techniques discussed in these sessions could be used against real websites/applications</li><li>don&rsquo;t do that</li></ul></section><section><h2 id=acknowledgement-of-country>acknowledgement of country</h2><ul><li>We begin by acknowledging the Traditional Custodians of the land on which we meet, and pay our respects to their Elders past and present. We extend that arespect to Aboriginal and Torres Strait Islander peoples here today.</li></ul></section><section><h2 id=what-will-we-cover-this-session>what will we cover this session</h2><ul><li>hash cracking</li><li>network packet analysis</li><li>drive analysis</li><li>memory analysis</li></ul><section data-shortcode-section></section><section><h2 id=password--hash-cracking>password / hash cracking</h2></section><section><h3 id=what-is-the-purpose-of-this>what is the purpose of this?</h3><ul><li>if we find a hash, how do we find the original value?<ul><li>think of SQLi, where we can dump the database?</li><li>what if we find hashes of other things?</li></ul></li><li>what about finding a password protected file, how do we open it?</li></ul></section><section><h3 id=what-do-we-do>what do we do</h3><ul><li>think back to the first session where we found additional subdomains/web content using a brute forcing script</li><li>just do the same thing?</li><li>try out every password until one of them works?</li></ul></section><section><h3 id=some-things-to-note>some things to note</h3><ul><li>there&rsquo;s a lot of different hashing algorithms, you&rsquo;ll need to know what format the hash is otherwise you can&rsquo;t really bruteforce it</li><li>also you should consider whether the hash is salted</li><li>hashcat & john both have options for these</li></ul></section><section><h3 id=demo>Demo</h3></section></section><section><h2 id=forensics>Forensics</h2></section><section><h3 id=heading></h3><ul><li>a bit different to what has been covered before</li><li>dfir is more situation-based, and covers more of the defensive side.</li></ul></section><section><h3 id=what-might-you-do>what might you do</h3><p>generally it&rsquo;s malware analysis</p><ul><li>finding command and control (c2) traffic</li><li>breach detection</li><li>finding what was stolen</li><li>finding patient zero</li></ul></section><section><section data-shortcode-section><h2 id=network-forensics>Network forensics</h2></section><section><h3 id=what-is-a-packet>What is a packet?</h3><ul><li><p>a chunk of data, forming part of a complete message</p></li><li><p>max packet size is about 65kb, so what happens when you stream a movie</p></li></ul></section><section><h3 id=what-is-in-a-packet>What is in a packet</h3><ul><li><p>All packets contain a header and a payload</p></li><li><p>Payload is all the data</p></li><li><p>Header contains any metadata (e.g. length, protocol, source, destination)</p></li></ul></section><section><h3 id=osi-what>OSI What</h3><p><img src=../assets/img/week04/osi_model.jpg alt></p></section><section><h3 id=what-is-a-packet-capture>What is a packet capture?</h3><ul><li>Intercepting packets travelling across a network, and logging them to a file</li></ul><blockquote><p>What could be a problem with this?</p></blockquote></section><section><h3 id=demo>Demo</h3></section></section><section><section data-shortcode-section><h3 id=wireshark>wireshark</h3><blockquote><p>how to use it</p></blockquote></section><section><h3 id=filters>filters</h3><ul><li>there&rsquo;s two types of filters<ul><li>display filters: match metadata about the packet (e.g. source ip, protocol)</li><li>pattern matching: match content in the filter (e.g. packet bytes/details)</li></ul></li></ul></section><section><h3 id=display-filters>display filters</h3><ul><li>just a boolean expression (similar to C)<ul><li><code>(f_1 eq AAA && f_2 ne BBB) || f_3</code></li></ul></li><li>you can search by<ul><li><strong>protocol</strong> (e.g. <code>http</code>)</li><li><strong>ip</strong> (e.g. <code>ip.src_host</code> and <code>ip.dst_host</code>)</li><li>and a bunch more <a href=https://wiki.wireshark.org/DisplayFilters>here</a> and <a href=https://www.wireshark.org/docs/wsug_html_chunked/ChWorkBuildDisplayFilterSection.html>here</a></li></ul></li></ul></section><section><h3 id=following-conversation>following conversation</h3><p>each packet will be tied to a &ldquo;conversation&rdquo;</p><ul><li>you can follow them by<ul><li>right clicking a packet > <code>follow X stream</code></li><li>filtering for <code>X.stream eq N</code></li></ul></li></ul><blockquote><p><code>X</code> would be <code>TCP</code> or <code>UDP</code></p></blockquote><blockquote><p><code>N</code> would be a number</p></blockquote></section><section><h3 id=what-should-i-be-looking-for>what should I be looking for</h3><ul><li>wierd IPs being communicated with</li><li>files being downloaded/uploaded</li><li>you can look for communicaion made at the same as evidence you found</li></ul></section><section><h3 id=if-you-find-something-sus>if you find something sus</h3><blockquote><p>a good place to go is <a href=https://www.virustotal.com/gui/>virustotal</a></p></blockquote></section><section><h3 id=decrypting-traffic>decrypting traffic</h3><p>Some traffic will be encrypted (e.g. SSH/HTTPS), so you won&rsquo;t be able to read the packets</p><ul><li>Edit > Preferences</li><li>Protocols > TLS</li></ul><blockquote><p>There you can you upload the tls/ssl keys to decrypt the traffic</p></blockquote></section><section><h2 id=demo>Demo</h2></section></section><section><section data-shortcode-section><h2 id=memory-forensics>memory forensics</h2></section><section><h3 id=what-is-it>what is it?</h3><ul><li>investigating a dump of the RAM from a computer system</li></ul></section><section><h3 id=when-is-this-useful>when is this useful</h3><blockquote><p>when?</p></blockquote></section><section><h3 id=when-is-this-useful-1>when is this useful</h3><ul><li><p>there&rsquo;s a lot you can&rsquo;t get from a harddisk image</p><ul><li>if/when a program was executed</li><li>how it was executed (arguments, lifespan)</li></ul></li><li><p>some malware never touches the disk</p></li></ul></section><section><h3 id=fileless-malware>fileless malware</h3><ul><li>even if it never touches disk, at some point, it has to be in memory</li><li>process hollowing: when a legitimate process is paused, duplicated, and then it&rsquo;s executable memory is replaced with malicious code</li><li>this can bypass simple AVs which ignore whitelisted/trusted services</li></ul><blockquote><p>read more <a href=https://www.trellix.com/en-au/security-awareness/ransomware/what-is-fileless-malware.html>here</a> and <a href=https://www.crowdstrike.com/cybersecurity-101/malware/fileless-malware/>here</a></p></blockquote></section><section><p><img src=../assets/img/week05/inmemory-malware.png alt></p></section><section><h3 id=what-could-you-find-in-memory>what could you find in memory?</h3><blockquote><p>what</p></blockquote></section><section><h3 id=what-could-you-find-in-memory-1>what could you find in memory?</h3><ul><li>recently executed commands</li><li>running processes, and their code/DLLs</li><li>drivers & daemons</li><li>passwords, security keys, security information</li></ul></section></section><section><h3 id=what-processes-are-sus-ඞ>what processes are sus ඞ</h3><p><span class=fragment><p>obfuscate names/paths (drop some malware in a system location and give it a legitimate name)</p></span><span class=fragment><p>misspelled versions of proper system processes</p></span><span class=fragment><p>proper system names in wrong location</p></span><span class=fragment><p>duplicate processes that should only spawn once</p></span><span class=fragment><p>processes that have a parent they shouldn’t</p></span><span class=fragment><p>system processes with start time much later in life</p></span><span class=fragment><p>system processes running under a user account</p></span></p></section><section><section data-shortcode-section><h3 id=volatility>volatility</h3><blockquote><p>cause RAM is volatile lol</p></blockquote></section><section><h3 id=list-all-the-processes>list all the processes</h3><ul><li><code>windows.pstree</code><ul><li>get processes tree (not hidden)</li></ul></li><li><code>windows.pslist</code><ul><li>get process list (EPROCESS)</li></ul></li><li><code>windows.psscan</code><ul><li>get hidden process list (e.g. malware)</li></ul></li></ul></section><section><h3 id=dumping-a-process>dumping a process</h3><ul><li><code>windows.dumpfiles --pid &lt;PID></code><ul><li>get the executable & DLLs</li></ul></li><li><code>windows.memmap --dump --pid &lt;PID></code><ul><li>get all memory resident pages</li></ul></li><li><code>windows.dllist --pid &lt;PID></code><ul><li>list the DLLs used by a process</li></ul></li></ul></section><section><h3 id=see-how-a-process-was-started>see how a process was started</h3><ul><li><code>windows.cmdline</code><ul><li>shows the arguments used for the process</li></ul></li><li><code>windows.envars [--pid &lt;pid>]</code><ul><li>display process environment variables</li></ul></li><li><code>windows.handles --pid &lt;pid></code><ul><li>show files, threads, etc a process has opened</li></ul></li></ul></section><section><h3 id=registries>registries</h3><ul><li><code>windows.registry.hivescan</code><ul><li>TODO</li></ul></li><li><code>windows.registry.hivelist</code><ul><li>TODO</li></ul></li><li><code>windows.registry.printkey -K "Path\To\Key"</code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=viewing-files>viewing files</h3><ul><li><code>windows.filescan</code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles</code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles --virtaddr &lt;o></code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles --physaddr &lt;o></code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=networking>networking</h3><ul><li><code>windows.netscan</code><ul><li>TODO</li></ul></li><li><code>windows.netstat</code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=pattern-match-strings>pattern match strings</h3><ul><li><code>windows.strings --strings-file ./strings_file</code><ul><li>TODO</li></ul></li><li><code>windows.vadyarascan --yara-rules "https://" --pid &lt;PIDS></code><ul><li>TODO</li></ul></li><li><code>yarascan.YaraScan --yara-rules &lt;R></code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=dumping-hashes>dumping hashes</h3><ul><li><code>windows.hashdump</code><ul><li>grab common windows hashes (SAM+SYSTEM)</li></ul></li><li><code>windows.cachedump</code><ul><li>grab domain cache hashes inside the registry</li></ul></li><li><code>windows.lsadump</code><ul><li>grab lsa secrets</li></ul></li></ul></section><section><h3 id=reference-list>reference list</h3><ul><li>command list can be found <a href=https://github.com/volatilityfoundation/volatility/wiki/Command-Reference>here</a></li><li>some other <a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/memory-dump-analysis/volatility-cheatsheet>stuff</a></li></ul></section><section><h2 id=demo>Demo</h2></section></section><section><h3 id=next-week>next week</h3><ul><li>reverse engineering?</li></ul></section><section><h2 id=thanks>thanks!</h2><p>that&rsquo;s all :)</p></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>