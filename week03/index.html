<!doctype html><html lang=en><head><meta charset=utf-8><title>week03: serverside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1305>We&rsquo;ll get started at 13:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=server-side-exploitation>server-side exploitation</h1><h2 id=week03>week03</h2></section><section><h2 id=disclaimer>disclaimer</h2><ul><li>many of the tools and techniques discussed in these sessions could be used against real applications</li><li>dont do that</li></ul></section><section><h2 id=acknowledgement-of-country>acknowledgement of country</h2><ul><li>We begin by acknowledging the Traditional Custodians of the land on which we meet, and pay our respects to their Elders past and present. We extend that arespect to Aboriginal and Torres Strait Islander peoples here today.</li></ul></section><section><h3 id=housekeeping>housekeeping</h3><p>did anyone try out any of the challenges? how did you go?</p></section><section><section data-shortcode-section><h2 id=what-will-we-cover-this-session>what will we cover this session</h2><ul><li>SQLi</li><li>SSTI</li><li>SSRF</li><li>LFI</li></ul></section></section><section><section data-shortcode-section><h2 id=sql>SQL</h2><p>Structured Query Language</p><ul><li>e.g. SQLite, PostgreSQL, MySQL, MSSQL Server</li></ul></section><section><blockquote><p>Fingerprinting</p></blockquote><ul><li>work out the flavour/version<ul><li><strong>MySQL</strong>: <code>Version()</code></li><li><strong>SQLite</strong>: <code>sqlite_version()</code></li><li><strong>MSSQL</strong>: <code>@@Version</code></li></ul></li></ul></section><section><blockquote><p>Finding the schema</p></blockquote><ul><li>what tables exist, what do they look like?<ul><li><strong>MySQL</strong>: <code>information_schema.[tables|columns]</code></li><li><strong>SQLite</strong>: <code>sqlite_[master|schema]</code></li><li><strong>MSSQL</strong>: <code>SHOW TABLES; DESCRIBE &lt;table_name></code></li></ul></li></ul></section><section><p>Queries ></p><ul><li><code>SELECT &lt;column> FROM &lt;table>;</code></li><li><code>INSERT INTO table VALUES (a, b);</code></li><li><code>UPDATE table SET ... = ...</code></li><li><del><code>DELETE FROM table ...</code></del> (<em>pls dont</em>)</li><li><code>-- a comment (also #)</code></li></ul></section><section><p><code>SELECT \* FROM table WHERE ...</code></p><ul><li><code>col = ...</code></li><li><code>col > ...</code></li><li><code>col &lt; ...</code></li><li><code>col &lt;> ... #</code> not equals (!=)</li><li><code>col LIKE ... #</code> regexp<ul><li><code>_</code> <code>(.)</code> and <code>%</code> <code>(.*)</code> are wildcards</li></ul></li></ul></section><section><p><code>SELECT user, pass FROM users UNION SELECT title, author FROM blogs</code></p><pre tabindex=0><code>  user	  pass	     id	  title   author	THE UNION
|=======|=======|   |===|=======|=======|   |=======|=======|
| admin	| admin	|   | 1 | blog1 | melon |   | admin | admin |
| melon	| water	|   | 2 | blog2 | admin |   | melon | water |
|=======|=======|   | 3 | blog3 | admin |   | blog1 | melon |
		            |===|=======|=======|   | blog2 | admin |
		 		                     	    | blog3 | admin |
      users		            blogs   	    |=======|=======|
</code></pre></section><section><h2 id=notes-on-unions>Notes on UNIONs</h2><ul><li>The query needs to extract the same number of columns from both tables</li><li>The data-type for the columns must be compatible</li><li>You can also UNION the same table</li></ul></section></section><section><section data-shortcode-section><h2 id=sqli>SQLi</h2><p>SQL Injection</p><ul><li><p><em>TLDR</em>: blindly trusting user input is bad</p></li><li><p>What if we injected control characters which changed how the database interprets the query? e.g. inject our own <code>UNIONs/WHEREs/etc</code></p></li><li><p>How could it tell the difference?</p></li></ul></section><section><h3 id=how-does-sqli-work>How does SQLi work</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{input}&#39;</span> <span style=color:#66d9ef>AND</span> password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{...}&#39;</span>
</span></span></code></pre></div><p> </p><p>If our input was: <code>' OR 1=1 --</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>--                        vvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e>--&#39;and password = &#39;...&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--                        ^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- user = &#39;&#39; is always false, but 1=1 is always true
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- so this will return every user from the database
</span></span></span></code></pre></div></section><section><h3 id=issues-you-may-encounter>Issues you may encounter</h3><ul><li><p>Syntax needs to be correct, or you&rsquo;ll throw an error</p><ul><li>so, determine syntax through errors/fingerprint</li></ul></li><li><p>You have SQLi in <code>items</code>, but want <code>users</code></p><ul><li>find out the tables? (database schema)</li><li>include that table with a <code>UNION</code></li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waughcbatreemaindemosserver-sidesqli><a href=https://github.com/lachlan-waugh/cba/tree/main/demos/server-side/sqli>Demo</a></h2></section></section><section><section data-shortcode-section><h2 id=ssti>SSTI</h2><p>Server-side template injection</p><p>Templating engines (eg. Jinja2, Pug) use templates to inject code and variables into static files</p></section><section><h3 id=what-is-templating>what is templating</h3><p>similar to using variables in print</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Hello &#39;</span> <span style=color:#f92672>+</span> name)
</span></span></code></pre></div><p> </p><p>except you&rsquo;re using it for writing web content</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;!-- index.html --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>h1</span>&gt;Hello {{name}}&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span>&gt;it is currently {{time}}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e># main.py</span>
</span></span><span style=display:flex><span>render_template(<span style=color:#e6db74>&#34;index.html&#34;</span>, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;melon&#34;</span>, time<span style=color:#f92672>=</span>datetime<span style=color:#f92672>.</span>utcnow)
</span></span></code></pre></div></section><section><h3 id=how-to-exploit-this>how to exploit this?</h3><p>what if we tricked the template rendering into thinking our user-supplied content was code?</p><ul><li><p>if our username was <code>{{7*7}}</code>, it would evaluated to 49</p></li><li><p>Jinja2: <code>{{</code>&lt;CODE HERE><code>}}</code> e.g. <code>{{ 'A'*3 }}</code> => <code>AAA</code></p></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waughcbatreemaindemosserver-sidessti><a href=https://github.com/lachlan-waugh/cba/tree/main/demos/server-side/ssti>Demo</a></h2></section></section><section><h2 id=ssrf>SSRF</h2><section data-shortcode-section><h3 id=server-side-request-forgery>Server-side request forgery</h3><p>Trick a server into doing stuff it doesn&rsquo;t intend to</p><ul><li><p>Consider a website w/ a database in the backend</p></li><li><p>You can access the website, website can access the database, but you can&rsquo;t access the database.</p></li><li><p>What if we tricked the website into making a request to that database when it doesn&rsquo;t intend to?</p></li></ul></section><section><p><img src=../assets/img/week03/ssrf.png alt></p></section><section><h3 id=exploitation>Exploitation</h3><ul><li><p>Internal services might (often will) be less secure than externally facing ones</p></li><li><p>What can we do?</p><ul><li>Retrieve/disclose information (ssi/lfi)</li><li>Remote code execution / Reverse shells?</li><li>Other bad stuff</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waughcbatreemaindemosserver-sidessrf><a href=https://github.com/lachlan-waugh/cba/tree/main/demos/server-side/ssrf>Demo</a></h2></section></section><section><section data-shortcode-section><h3 id=lfi>LFI</h3><p>Local File Inclusion</p><ul><li><p>Tricking a server to include a local file in it&rsquo;s output</p></li><li><p>In SSRF we tricked the server into downloading content from something running in it&rsquo;s network</p></li><li><p>What if instead, we told it do download a local file?</p></li></ul></section><section><h3 id=directory-traversal>Directory traversal</h3><ul><li><p>If you can download a file from the server from a certain location, e.g.:</p><ul><li><code>https://website.com/files/file1</code></li></ul></li><li><p>You could try access a file from other locations:</p><ul><li><code>https://website.com/files/../../../../other/file</code></li></ul></li></ul><blockquote><p><code>..</code> refers to the parent directory, so we&rsquo;re navigating up the file system to find other files hosted locally</p></blockquote></section><section><h3 id=idk-something-else>Idk, something else</h3><ul><li>When making a request (think back to SSRF), we provide a url/uri e.g. <code>https://website.com</code><ul><li><code>https://</code> is the scheme and tells the server to access it over the internet (basically)</li><li><code>file://</code> is another scheme, telling the server to instead look at the local file system</li><li>give it <code>file:///path/to/some/file</code></li></ul></li></ul></section><section><h3 id=something-to-note>Something to note</h3><blockquote><p>the <code>/proc/self/</code> directory contains information about the currently running process, you can use this to disclose information: e.g. environment variables, current path, etc</p></blockquote></section><section><h2 id=demohttpsgithubcomlachlan-waughcbatreemaindemosserver-sidelfi><a href=https://github.com/lachlan-waugh/cba/tree/main/demos/server-side/lfi>Demo</a></h2></section></section><section><h3 id=suggested-challenges>suggested challenges</h3><ul><li><a href="https://play.picoctf.org/practice?category=1&amp;page=1">picoctf</a> (look at web exploitation)</li><li><a href=https://overthewire.org/wargames/natas/>overthewire natas</a></li></ul></section><section><h3 id=next-week>next week</h3><p>binary exploitation</p><ul><li>programming logic errors</li><li>buffer overflows (maybe? idk)</li></ul></section><section><h2 id=thanks>thanks!</h2><p>that&rsquo;s all :)</p></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>