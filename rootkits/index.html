<!doctype html><html lang=en><head><meta charset=utf-8><title>rootkits</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section data-noprocess data-shortcode-slide class=center><h2 id=rootkits>rootkits</h2><h3 id=lunch--learn>lunch & learn</h3></section><section><section data-shortcode-section><h3 id=overview>overview</h3><ul><li>userland kits</li><li>os internals</li><li>kernelland kits</li></ul></section><section><h3 id=what-is-a-rootkit>what is a rootkit</h3><ul><li><del>exploitation/exercising a vulnerability</del>*</li><li><del>a program to get root</del>*</li><li>a post exploitation tool for:<ul><li>persistence, and</li><li>stealth</li></ul></li></ul><blockquote><p>* not always at least</p></blockquote></section><section><h3 id=an-example>an example</h3><p>you&rsquo;ve</p><ul><li>infected a device (gotten rce, malware, etc)</li><li>escalated your privileges to root</li><li>now what do you want to do?</li></ul></section><section><h3 id=what-do-we-want-a-rootkit-to-do>what do we want a rootkit to do</h3><ul><li>persistence<ul><li>surviving reboots</li><li>backdooring</li></ul></li><li>stealth<ul><li>hiding processes/files/network activity</li><li>cleaning logs</li><li>evading detection</li><li>e.g. hiding other malware</li></ul></li></ul></section></section><section><h3 id=how-do-rootkits-work>how do rootkits work?</h3><ul><li>you are the admin/superuser/root</li><li>you can do anything</li><li><strong>hooking functions</strong><ul><li>appending additional functionality</li><li>not replacing it</li></ul></li><li>the operating system is just a program</li></ul></section><section><section data-shortcode-section><h3 id=userland-kits>userland kits</h3><ul><li>often based on replacing utilities<ul><li><em>ls</em>: doesn&rsquo;t show rootkit&rsquo;s files</li><li><em>netstat</em>: doesn&rsquo;t reveal rootkit&rsquo;s ports</li><li><em>ps</em>: doesn&rsquo;t show rootkit&rsquo;s processes</li><li><em>cat</em>: show fake file contents</li></ul></li></ul></section><section><h3 id=heading></h3><ul><li>overriding system libraries<ul><li>overwriting <code>libc.so</code></li><li><code>LD_PRELOAD</code></li></ul></li></ul></section><section><h3 id=windows>windows</h3><p>relatively common on windows</p><ul><li>overwriting DLLs (dynamically linked libraries)</li><li><del>IAT (Import Address Table) Hooking</del> (its RO now)</li><li>Inline Hooking</li></ul></section><section><h3 id=problems>problems</h3><p>these are all pretty bad</p><ul><li>these are pretty easy to detect by a simple AV<ul><li>the hash of the files are changing</li></ul></li><li>does pythons <code>os.listdirs()</code> use <code>ls</code>? &mldr; no</li></ul></section></section><section><section data-shortcode-section><h3 id=operating-systems>operating systems</h3><p><img src=../assets/img/rootkits/rings.png alt></p></section><section><h3 id=kernel>kernel</h3><p>kernel is the most privileged part of an OS</p><ul><li>operates in ring0</li><li>can do basically anything<ul><li>execute any instruction</li><li>read/write anywhere</li><li>access hardware</li></ul></li></ul><blockquote><p>used to be like this, not anymore</p></blockquote></section><section><h3 id=userland>userland</h3><ul><li>userland we can&rsquo;t access hardware<ul><li>we don&rsquo;t modify the pixels when calling <code>print()</code></li><li>we can&rsquo;t just directly read the harddrive</li></ul></li><li>we tell the kernel to do this via syscalls</li></ul><blockquote><p>syscalls are the eyes of the application</p></blockquote></section><section><h3 id=system-calls>system calls</h3><p><img src=../assets/img/rootkits/syscall.png alt></p></section></section><section><h3 id=kernelland-kits>kernelland kits</h3><ul><li>two main types<ul><li>hooking (static)</li><li>modules (dynamic)</li></ul></li></ul></section><section><section data-shortcode-section><h3 id=hooking>hooking</h3><p>every userland program uses syscalls</p><ul><li>what if we overwrote these syscalls</li><li>and made them do what we want</li></ul></section><section><h3 id=how-do-we-do-this>how do we do this</h3><p>that&rsquo;s the hard part</p><ul><li>overwriting the system call table</li><li>overwriting the system call itself</li></ul></section><section><h3 id=still-kinda-bad>still kinda bad</h3><ul><li>AV could detect<ul><li>the system call table changes</li><li>or that the system call itself is changing</li><li>or that the address of the syscall is abnormal</li></ul></li></ul></section><section><h3 id=interrupt-descriptor-table>interrupt descriptor table</h3><p>another table of function pointers</p><p>interrupts are how the system goes from user to kernel-mode</p><ul><li>page faults</li><li>errors (divide-by-zero)</li></ul></section></section><section><section data-shortcode-section><h3 id=modules>modules</h3></section></section><section><section data-shortcode-section><h3 id=detections>detections</h3></section><section><h3 id=syscall-hooking>syscall hooking</h3><p>pretty easy to detect</p><table><thead><tr><th>syscall</th><th>function *</th></tr></thead><tbody><tr><td>sys_write</td><td>0xFFABCDEF</td></tr><tr><td>sys_read</td><td>0xAAAB0122</td></tr><tr><td>sys_open</td><td>0xFFABCE10</td></tr></tbody></table></section><section><h3 id=library-hooking>library hooking</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e># 6pm</span>
</span></span><span style=display:flex><span>cat /bin/ls | sha256sum
</span></span><span style=display:flex><span>a6f7b874ea69329372ad75353314d7bcacd8c0be365023dab195bcac015d6009
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 7pm</span>
</span></span><span style=display:flex><span>cat /bin/ls | sha256sum
</span></span><span style=display:flex><span>7aad4dc6e4d99b28d4857b4e06f7522a6aba48999a63ed850621dbbf89050185
</span></span></code></pre></div><blockquote><p>but I didn&rsquo;t update ls?</p></blockquote></section><section><h3 id=why-is-it-hard>why is it hard</h3><p>performance</p><ul><li>detections for the kernel require kernel-code</li><li>detections are really slow<ul><li>do you verify every syscall?</li><li>every page fault?</li></ul></li><li>any AV would need to run as root</li></ul></section><section></section></section><section><h3 id=even-scarier-versions-of-rootkits>even scarier versions of rootkits</h3><ul><li>hypervisor rootkits (sits above the os)<ul><li>really bad for cloud computing</li></ul></li><li>BIOS rootkits</li><li>Memory hooking</li></ul></section><section><h3 id=any-questions>Any questions?</h3></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>